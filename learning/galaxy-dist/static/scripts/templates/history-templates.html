<script type="text/template" class="template-history" id="template-history-warning-messages">
{{#if deleted}}{{#warningmessagesmall}}
    This dataset has been deleted.
    {{#if undelete_url}}
        Click <a href="{{ undelete_url }}" class="historyItemUndelete" id="historyItemUndeleter-{{ id }}"
                 target="galaxy_history">here</a> to undelete it
        {{#if purge_url}}
        or <a href="{{ purge_url }}" class="historyItemPurge" id="historyItemPurger-{{ id }}"
           target="galaxy_history">here</a> to immediately remove it from disk
        {{/if}}
    {{/if}}
{{/warningmessagesmall}}{{/if}}

{{#if purged}}{{#warningmessagesmall}}
    This dataset has been deleted and removed from disk.
{{/warningmessagesmall}}{{/if}}

{{#unless visible}}{{#warningmessagesmall}}
    This dataset has been hidden.
    {{#if unhide_url}}
        Click <a href="{{ unhide_url }}" class="historyItemUnhide" id="historyItemUnhider-{{ id }}"
                 target="galaxy_history">here</a> to unhide it
    {{/if}}
{{/warningmessagesmall}}{{/unless}}
</script>

<script type="text/template" class="template-history" id="template-history-titleLink">
<a href="javascript:void(0);"><span class="historyItemTitle">{{ hid }}: {{ name }}</span></a>
</script>

<script type="text/template" class="template-history" id="template-history-hdaSummary">
<div class="hda-summary">
    {{ misc_blurb }}<br />
    format: <span class="{{ data_type }}">{{ data_type }}</span>,
    database:
    {{#if dbkey_unknown_and_editable }}
        <a href="{{ edit_url }}" target="galaxy_main">{{ metadata_dbkey }}</a>
    {{else}}
        <span class="{{ metadata_dbkey }}">{{ metadata_dbkey }}</span>
    {{/if}}
</div>
{{#if misc_info}}
<div class="hda-info">{{ misc_info }}</div>
{{/if}}
</script>

<script type="text/template" class="template-history" id="template-history-failedMetaData">
{{#warningmessagesmall}}
An error occurred setting the metadata for this dataset.
You may be able to <a href="{{ edit_url }}" target="galaxy_main">set it manually or retry auto-detection</a>.
{{/warningmessagesmall}}
</script>

<script type="text/template" class="template-history" id="template-history-downloadLinks">
{{#if meta_files}}
<div popupmenu="dataset-{{id}}-popup">
    <a class="action-button" href="{{download_url}}">Download Dataset</a>
    <a>Additional Files</a>
    {{#each meta_files}}
    <a class="action-button" href="{{meta_download_url}}">Download {{meta_file_type}}</a>
    {{/each}}
</div>
<div style="float:left;" class="menubutton split popup" id="dataset-{{id}}-popup">
    <a href="{{download_url}}" title="Download" class="icon-button disk tooltip"></a>
</div>
{{else}}
<a href="{{download_url}}" title="Download" class="icon-button disk tooltip"></a>
{{/if}}
</script>

<script type="text/template" class="template-history" id="template-history-tagArea">
{{! TODO: move to mvc/tag.js templates }}
<div class="tag-area" style="display: none;">
    <strong>Tags:</strong>
    <div class="tag-elt">
    </div>
</div>
</script>

<script type="text/template" class="template-history" id="template-history-annotationArea">
{{! TODO: move to mvc/annotations.js templates, editable-text }}
<div id="{{ id }}-annotation-area" class="annotation-area" style="display: none;">
    <strong>Annotation:</strong>
    <div id="{{ id }}-anotation-elt" class="annotation-elt tooltip editable-text"
         style="margin: 1px 0px 1px 0px" title="Edit dataset annotation">
    </div>
</div>
</script>

<script type="text/template" class="template-history" id="template-history-displayApps">
{{#each displayApps}}
    {{label}}
    {{#each links}}
        <a target="{{target}}" href="{{href}}">{{text}}</a>
    {{/each}}
    <br />
{{/each}}
</script>

<!--
History panel/page - the main container for hdas (gen. on the left hand of the glx page)
-->
<script type="text/template" class="template-history" id="template-history-historyPanel">
<div id="top-links" class="historyLinks">
    <a title="{{#local}}refresh{{/local}}" class="icon-button arrow-circle tooltip" href="{{baseURL}}"></a>
    <a title='{{#local}}collapse all{{/local}}' class='icon-button toggle tooltip' href='#' style="display: none"></a>
    {{#if userRoles}}
    <div style="width: 40px; float: right; white-space: nowrap;">
        <a id="history-tag" title="{{#local}}Edit history tags{{/local}}"
            class="icon-button tags tooltip" target="galaxy_main" href="{{tagURL}}"></a>
        <a id="history-annotate" title="{{#local}}Edit history annotation{{/local}}"
            class="icon-button annotate tooltip" target="galaxy_main" href="{{annotateURL}}"></a>
    </div>
    {{/if}}
</div>
<div class="clear"></div>

{{! TODO: move to js with no reload - use each with historyLinks }}
{{#if showDeleted}}
<div class="historyLinks">
    <a href="{{hideDeletedURL}}">{{#local}}hide deleted{{/local}}</a>
</div>
{{/if}}

{{#if showHidden}}
<div class="historyLinks">
    <a href="{{hideHiddenURL}}">{{#local}}hide hidden{{/local}}</a>
</div>
{{/if}}

{{! history name (if any) }}
<div id="history-name-area" class="historyLinks">
    <div id="history-name-container" style="position: relative;">
        {{#if userRoles}}
            {{! TODO: factor out conditional css }}
            <div id="history-size" style="position: absolute; top: 3px; right: 0px;">{{diskSize}}</div>
            <div id="history-name" style="margin-right: 50px;" class="tooltip editable-text" title="Click to rename history">{{name}}</div>
            
        {{else}}
            <div id="history-size">{{diskSize}}</div>
        {{/if}}
    </div>                     
</div>
<div style="clear: both;"></div>

{{#if deleted}}
{{#warningmessagesmall}}{{#local}}You are currently viewing a deleted history!{{/local}}{{/warningmessagesmall}}
{{/if}}

{{! tags and annotations }}
{{! TODO: wire these to js events }}
{{#if userRoles}}
{{! TODO: move inline styles out }}
<div style="margin: 0px 5px 10px 5px">

    <div id="history-tag-area" style="display: none">
        <b>Tags:</b>
        {{! load via js render_individual_tagging_element }}
        {{! render_individual_tagging_element(user=trans.get_user(), tagged_item=history, elt_context="history.mako", use_toggle_link=False, input_size="20") }}
    </div>

    <div id="history-annotation-area" style="display: none">
        <strong>Annotation / Notes:</strong>
        <div id="history-annotation-container">
        <div id="history-annotation" class="tooltip editable-text" title="Click to edit annotation">
            {{#if annotation}}
                {{annotation}}
            {{else}}
                <em>Describe or add notes to history</em>
            {{/if}}
        </div>
        </div>
    </div>
</div>
{{/if}}

{{#if message}}
<div id="message-container">
    <div class="{{status}}message">
    {{message}}
    </div><br />
</div>
{{/if}}

<div id="quota-message-container">
    {{#if over_quota}}
    <div id="quota-message" class="errormessage">
        You are over your disk quota.  Tool execution is on hold until your disk usage drops below your allocated quota.
    </div>
    <br/>
    {{/if}}
</div>

{{#if itemsLength}}
<div id="{{id}}-datasets" class="history-datasets-list">
    {{! NOTE: HistoryItemViews will be appended here }}
</div>

{{else}}{{! no history items }}
<div class="infomessagesmall" id="emptyHistoryMessage">
{{#local}}Your history is empty. Click 'Get Data' on the left pane to start{{/local}}
</div>
{{/if}}
</script>



